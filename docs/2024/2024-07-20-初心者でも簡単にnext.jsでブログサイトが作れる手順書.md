---
draft: true
emoji: 🍹
title: 初心者でも簡単にNext.jsでブログサイトが作れる手順書
slug: step-by-step-instructions-for-beginners-to-build-a-blog-site-in-next-js
published_at: 2024-07-20 01:12:22
modified_at: 2024-07-20 01:12:22
tags:
  - Next.js
  - Hacker Sheet
preview: null
type: default
---

## はじめに

筆者の作成した[Webサービス](https://hackersheet.com)を使ってNext.jsでブログサイトを構築する手順を紹介しています。興味のある方のみ読み進めてください。

> [!IMPORTANT]
> この記事ではmacOSの環境での作業手順を紹介しています。他の環境の場合はコマンドなどを適宜読み替える必要があります。

## Node.js v20とpnpm環境のセットアップ

Node.jsがインストールされていない場合は[Voltaでローカル環境にNode.jsをインストールしよう(macOS)](2024-07-19-voltaでローカル環境にnode.jsをインストールしよう.md)という記事を参考にNode.jsとpnpmのセットアップをしましょう。

## Next.jsアプリケーションの作成

```sh:Terminal
pnpm create next-app
```

```text:実行結果
✔ What is your project named? … my-blog
✔ Would you like to use TypeScript? … Yes
✔ Would you like to use ESLint? … Yes
✔ Would you like to use Tailwind CSS? … Yes
✔ Would you like to use `src/` directory? … Yes
✔ Would you like to use App Router? (recommended) … Yes
✔ Would you like to customize the default import alias (@/*)? … Yes
✔ What import alias would you like configured? … @/*
Creating a new Next.js app in /path/to/my-blog.

Using pnpm.
```

```sh:Terminal
code my-blog
```

## pnpm update

```sh:Terminal
pnpm update
```

## npmパッケージを追加

```sh:Terminal
pnpm add @hackersheet/core@alpha @hackersheet/next-document-content-components@alpha @hackersheet/next-document-content-kifu@alpha @hackersheet/react-document-content@alpha @hackersheet/react-document-content-styles@alpha katex
```

```json:package.json
// ...
"dependencies": {
  "@hackersheet/core": "0.1.0-alpha.4", // [!code ++]
  "@hackersheet/next-document-content-components": "0.1.0-alpha.5", // [!code ++]
  "@hackersheet/next-document-content-kifu": "0.1.0-alpha.1", // [!code ++]
  "@hackersheet/react-document-content": "0.1.0-alpha.5", // [!code ++]
  "@hackersheet/react-document-content-styles": "0.1.0-alpha.4", // [!code ++]
  "katex": "^0.16.11", // [!code ++]
  "next": "14.2.5",
  "react": "^18.3.1",
  "react-dom": "^18.3.1"
},
// ...
```

## 環境変数の設定

`.env.development.local` を作成します。

```ini:.env.development.local
HACKERSHEET_API_ENDPOINT=https://api.hackersheet.com/example/v1/graphql
HACKERSHEET_API_ACCESS_KEY=hsws_TVZ6MjdnMUNrWXdyRjZ5SEZSOFp3OWVXS0ZiR3lHSFE6akdzVzQ5WlRhc0RwRm1ZWGRpZWl5aHZpM2ZtSlhSOG42ZExEbWZMQXd1c2dwdXZ0
```

## shadcn/uiのセットアップ

```sh:Terminal
pnpm dlx shadcn-ui@latest init
```

```text:実行結果
✔ Which style would you like to use? › Default
✔ Which color would you like to use as base color? › Slate
✔ Would you like to use CSS variables for colors? … no / yes

✔ Writing components.json...
✔ Initializing project...
✔ Installing dependencies...

Success! Project initialization completed. You may now add components.
```

## hackersheet/client.ts作成

```typescript:src/lib/hackersheet/client.ts
import { createClient } from '@hackersheet/core'
import { cache } from 'react'

const client = cache(() =>
  createClient({
    url: process.env.HACKERSHEET_API_ENDPOINT!,
    accessKey: process.env.HACKERSHEET_API_ACCESS_KEY!,
  })
)()

export { client }
```

## next.config.mjs

```javascript:next.config.mjs
/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    formats: ["image/webp"],
    remotePatterns: [
      {
        protocol: "https",
        hostname: "public-content.hackersheet.com",
        pathname: "/**",
      }
    ],
  },
};

export default nextConfig;
```

## CSS

`src/app/globals.css` の末尾に以下を追加してください。

```css:globals.css
/* ... */

@layer base {
  :root {
    --hsdc-scroll-margin-top: 0px;
    --hsdc-font-code: monospace, sans-serif;
    --hsdc-border: var(--border);
    --hsdc-muted: var(--muted);
    --hsdc-muted-foreground: var(--muted-foreground);
    --hsdc-link: var(--primary);
    --hsdc-code-block: var(--muted);
    --hsdc-shiki-diff-add: 160 84% 39%;
    --hsdc-shiki-diff-remove: 350 89% 60%;
    --hsdc-shiki-highlighted-word: 60 100% 50%;
  }

  :root {
    --github-alert-default-color: rgb(208, 215, 222);
    --github-alert-note-color: rgb(9, 105, 218);
    --github-alert-tip-color: rgb(26, 127, 55);
    --github-alert-important-color: rgb(130, 80, 223);
    --github-alert-warning-color: rgb(191, 135, 0);
    --github-alert-caution-color: rgb(207, 34, 46);

    .dark {
      --github-alert-default-color: rgb(48, 54, 61);
      --github-alert-note-color: rgb(31, 111, 235);
      --github-alert-tip-color: rgb(35, 134, 54);
      --github-alert-important-color: rgb(137, 87, 229);
      --github-alert-warning-color: rgb(158, 106, 3);
      --github-alert-caution-color: rgb(248, 81, 73);
    }
  }
}
```

## src/app ディレクトリのファイルを修正

- src/app/layout.tsx
- src/app/page.tsx

`src/app` ディレクトリ以下の、これらの2つのファイルを修正します。下記のコードをコピーして置き換えると楽です。

### src/app/layout.tsx

```tsx:src/app/layout.tsx
import type { Metadata } from "next";
import { Inter } from "next/font/google";
import "./globals.css";
import Link from "next/link";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body className={inter.className}>
        <header className="mx-auto max-w-screen-sm">
          <div className="text-lg py-10"><Link href="/">my blog</Link></div>
        </header>

        {children}
      </body>
    </html>
  );
}
```

### src/app/page.tsx

```tsx:src/app/page.tsx
import { client } from "@/lib/hackersheet/client";
import Link from "next/link";

export default async function Home() {
  const { documents } = await client.getDocuments();

  return (
    <main className="mx-auto max-w-screen-sm">
      <ul className="list-disc">
        {documents &&
          documents.map((document) => (
            <li key={document.id} className="my-2">
              <Link href={`/posts/${document.slug}`}>{document.title}</Link>
            </li>
          ))}
      </ul>
    </main>
  );
}
```

## src/app/posts/[documentSlug]/page.tsx 作成

`src/app/posts/[documentSlug]/page.tsx` を作成します。内容は以下のようにしてください。

```tsx:src/app/posts/[documentSlug]/page.tsx
import { client } from "@/lib/hackersheet/client";
import {
  CodeBlock,
  Image,
  Link,
  LinkCard,
  Mermaid,
  XPost,
  Youtube,
} from "@hackersheet/next-document-content-components";
import { Kifu, KifuTo } from "@hackersheet/next-document-content-kifu";
import { notFound } from "next/navigation";
import { DocumentContent } from "@hackersheet/react-document-content";
import documentContentStyle from "@hackersheet/react-document-content-styles/basic";

import "katex/dist/katex.min.css";

export default async function PostPage({
  params: { documentSlug },
}: {
  params: { documentSlug: string };
}) {
  const { document } = await client.getDocument({ slug: documentSlug });

  if (!document) notFound();

  return (
    <main className="mx-auto max-w-screen-sm">
      <h1 className="text-4xl font-bold pt-10 pb-20">{document.title}</h1>

      <DocumentContent
        document={document}
        style={documentContentStyle}
        permaLinkFormat="/posts/{{slug}}"
        components={{
          codeBlock: CodeBlock,
          image: Image,
          kifu: Kifu,
          kifuTo: KifuTo,
          link: Link,
          linkCard: LinkCard,
          mermaid: Mermaid,
          xPost: XPost,
          youtube: Youtube,
        }}
      />
    </main>
  );
}
```
