---
draft: false
emoji: ğŸ›¬
title: Next.js 16 + next-intl ã§å¤šè¨€èªåŒ–å¯¾å¿œã™ã‚‹ãŸã‚ã®è¨­å®šã¨æ³¨æ„ç‚¹
slug: nextjs-16-next-intl-multilingual-configuration-and-notes
published_at: 2026-02-11 16:31:22
modified_at: 2026-02-11 16:31:22
tags:
  - Next.js
  - TypeScript
preview: null
---

## æ¦‚è¦

Next.js 16 ã¨ next-intlï¼ˆv4.8.2ï¼‰ã§å¤šè¨€èªåŒ–ã‚’å®Ÿè£…ã™ã‚‹éš›ã®è¨­å®šæ‰‹é †ã¨ã€ãƒãƒã‚Šã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆã‚’ã¾ã¨ã‚ãŸã€‚

## ã¾ã¨ã‚

- Next.js 16 ã§ `middleware.ts` ãŒ `proxy.ts` ã«ç§»è¡Œã€`params` ç­‰ã®åŒæœŸã‚¢ã‚¯ã‚»ã‚¹ã‚‚å®Œå…¨å»ƒæ­¢
- `cacheComponents` + Parallel Routes ã®å‹•çš„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã§ Suspense ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹
- è§£æ±ºç­–ã¯ `[locale]/layout.tsx` ã‚’åŒæœŸã«ã—ã€`<html>` ã”ã¨ `<Suspense>` å†…ã®éåŒæœŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å§”è­²ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³

## Next.js 16 ã§å¤‰ã‚ã£ãŸã“ã¨

### middleware.ts â†’ proxy.ts

`middleware.ts` ãŒå»ƒæ­¢ã•ã‚Œ `proxy.ts` ã«ç½®ãæ›ã‚ã£ãŸã€‚`proxy.ts` ã¯ Node.js ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ã¿ã§å‹•ä½œã™ã‚‹ãŸã‚ã€Edge Runtime ã‚’å‰æã«ã—ã¦ã„ãŸã‚³ãƒ¼ãƒ‰ã¯è¦‹ç›´ã—ãŒå¿…è¦ã«ãªã‚‹ã€‚

### params ã®åŒæœŸã‚¢ã‚¯ã‚»ã‚¹ãŒå®Œå…¨å»ƒæ­¢

Next.js 15 ã§ã¯ deprecation warning ã ã£ãŸ `params` ã®åŒæœŸã‚¢ã‚¯ã‚»ã‚¹ãŒã€16 ã§ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚`searchParams`ã€`cookies()`ã€`headers()` ã‚‚åŒæ§˜ã€‚

```tsx
// Next.js 16ï¼ˆawait ãŒå¿…é ˆï¼‰
export default async function Layout({ params }: { params: Promise<{ locale: string }> }) {
  const { locale } = await params;
  return <html lang={locale}>...</html>;
}
```

æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ codemod ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã€‚

```bash
npx @next/codemod@canary upgrade latest
npx @next/codemod@latest next-async-request-api .
```

### Parallel Routes ã« default.tsx ãŒå¿…é ˆ

`[locale]` é…ä¸‹ã§ Parallel Routes ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã€ã™ã¹ã¦ã®ã‚¹ãƒ­ãƒƒãƒˆã« `default.tsx` ãŒå¿…è¦ã«ãªã£ãŸã€‚

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«

```json
// messages/ja.json
{
  "common": {
    "signIn": "ã‚µã‚¤ãƒ³ã‚¤ãƒ³",
    "signOut": "ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ"
  },
  "home": {
    "title": "ã‚ˆã†ã“ã",
    "description": "{name}ã•ã‚“ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰"
  }
}
```

åŒã˜æ§‹é€ ã§ `messages/en.json` ç­‰ã‚’ç”¨æ„ã™ã‚‹ã€‚

### 2. next.config.ts

```ts:next.config.ts
import createNextIntlPlugin from 'next-intl/plugin'

const withNextIntl = createNextIntlPlugin()

const nextConfig = {
  // ...
}

export default withNextIntl(nextConfig)
```

### 3. ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¨­å®š

```ts:i18n/request.ts
import { getRequestConfig } from 'next-intl/server'

export default getRequestConfig(async ({ requestLocale }) => {
  const locale = (await requestLocale) || 'ja'

  return {
    locale,
    messages: (await import(`../messages/${locale}.json`)).default,
  }
})
```

### 4. proxy.ts ã§ã®ãƒ­ã‚±ãƒ¼ãƒ«æ¤œå‡º

```ts:proxy.ts
import { locales, defaultLocale } from './i18n/config'

export function proxy(request: Request) {
  const url = new URL(request.url)
  const pathname = url.pathname

  const pathnameLocale = locales.find(
    (locale) => pathname.startsWith(`/${locale}/`) || pathname === `/${locale}`
  )

  if (pathnameLocale) return

  const acceptLanguage = request.headers.get('accept-language')
  const detectedLocale = negotiateLocale(acceptLanguage) || defaultLocale

  return Response.redirect(new URL(`/${detectedLocale}${pathname}`, request.url))
}
```

### 5. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

Parallel Routes ã‚’ä½¿ã‚ãªã„ï¼ˆã¾ãŸã¯ `cacheComponents` ã‚’ä½¿ã‚ãªã„ï¼‰å ´åˆã¯ã€ã‚·ãƒ³ãƒ—ãƒ«ãª async layout ã§å•é¡Œãªã„ã€‚

```tsx:app/[locale]/layout.tsx
import { setRequestLocale } from 'next-intl/server'
import { NextIntlClientProvider } from 'next-intl'
import { getMessages } from 'next-intl/server'

export function generateStaticParams() {
  return [{ locale: 'ja' }, { locale: 'en' }]
}

export default async function LocaleLayout({
  children,
  params,
}: {
  children: React.ReactNode
  params: Promise<{ locale: string }>
}) {
  const { locale } = await params
  setRequestLocale(locale)
  const messages = await getMessages()

  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  )
}
```

**Parallel Routes + `cacheComponents` ã‚’ä½¿ã†å ´åˆã¯ã€ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚** æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§è§£æ±ºç­–ã‚’èª¬æ˜ã™ã‚‹ã€‚

### 6. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ä½¿ç”¨

Server Component ã§ã‚‚ Client Component ã§ã‚‚ `useTranslations` ãŒä½¿ãˆã‚‹ã€‚

```tsx
// Server Component
import { useTranslations } from 'next-intl';
import { setRequestLocale } from 'next-intl/server';

export default async function Home({ params }: { params: Promise<{ locale: string }> }) {
  const { locale } = await params;
  setRequestLocale(locale);
  const t = useTranslations('home');

  return <h1>{t('title')}</h1>;
}
```

```tsx
// Client Component
'use client';
import { useTranslations } from 'next-intl';

export default function SignOutButton() {
  const t = useTranslations('common');
  return <button>{t('signOut')}</button>;
}
```

## cacheComponents + Parallel Routes ã§ã® Suspense ã‚¨ãƒ©ãƒ¼

Next.js 16 ã§ã¯ PPR ã¨ dynamicIO ãŒ `cacheComponents` ã«çµ±åˆã•ã‚ŒãŸã€‚ã“ã®æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã—ãŸçŠ¶æ…‹ã§ã€Parallel Routes å†…ã«å‹•çš„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ`[documentId]` ãªã©ï¼‰ãŒã‚ã‚‹ã¨ã€ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆãƒãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰æ™‚ã«ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã€‚

```text
Uncached data was accessed outside of `<Suspense>`
```

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ç™ºç”Ÿã—ãªã„ã€‚

### åŸå› 

Parallel Routes ã«ã¯ã€Œ1ã¤ã®ã‚¹ãƒ­ãƒƒãƒˆãŒ dynamic ãªã‚‰ã€åŒãƒ¬ãƒ™ãƒ«ã®å…¨ã‚¹ãƒ­ãƒƒãƒˆã‚‚ dynamic ã«ãªã‚‹ã€ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚‹ã€‚ãƒ‘ãƒ©ãƒ¬ãƒ«ãƒ«ãƒ¼ãƒˆå†…ã® `[documentId]` ã®ã‚ˆã†ãªå‹•çš„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒãƒ«ãƒ¼ãƒˆãƒ„ãƒªãƒ¼å…¨ä½“ã‚’ dynamic æ‰±ã„ã«ã—ã€`[locale]/layout.tsx` ã® `await params` ãŒ Suspense å¤–ã§ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ã¨ã—ã¦ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚

ã‚¨ãƒ©ãƒ¼ã®ãƒˆãƒ¬ãƒ¼ã‚¹ã¯ `[locale]/layout.tsx` ã‚’æŒ‡ã™ãŒã€ç›´æ¥ã®åŸå› ã¯ **ãƒ‘ãƒ©ãƒ¬ãƒ«ãƒ«ãƒ¼ãƒˆå†…ã®å‹•çš„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®å­˜åœ¨** ã ã€‚

### åŠ¹ã‹ãªã„å¯¾ç­–

| å¯¾ç­–                                         | åŠ¹ã‹ãªã„ç†ç”±                                                            |
| -------------------------------------------- | ----------------------------------------------------------------------- |
| `loading.tsx` ã®è¿½åŠ                          | page ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã ã‘ã§ã€parent layout ã® `await params` ã¯ã‚«ãƒãƒ¼ã—ãªã„ |
| page ã‚’åŒæœŸ + å­ã‚’ `<Suspense>` ã§å›²ã‚€       | å•é¡Œã¯ parent layout ãƒã‚§ãƒ¼ãƒ³ã«ã‚ã‚‹                                     |
| `generateStaticParams` ã®å®šç¾©                | ãƒ‘ãƒ©ãƒ¬ãƒ«ãƒ«ãƒ¼ãƒˆã®å‹•çš„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒä¸Šæ›¸ãã™ã‚‹                              |
| `<html>` ã‚’å¤–ã«ç½®ã `<body>` å†…ã ã‘ Suspense | `await params` ãŒ layout é–¢æ•°å†…ã«æ®‹ã‚‹                                   |

### è§£æ±ºç­–

`[locale]/layout.tsx` ã‚’åŒæœŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã—ã€`<html>` ã‚¿ã‚°ã‚’å«ã‚€å…¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ `<Suspense>` å†…ã®éåŒæœŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ç§»å‹•ã™ã‚‹ã€‚

```tsx
// app/[locale]/layout.tsx
import { Suspense } from 'react';
import { getMessages, setRequestLocale } from 'next-intl/server';
import { NextIntlClientProvider } from 'next-intl';

export function generateStaticParams() {
  return [{ locale: 'ja' }, { locale: 'en' }];
}

async function LocaleContent({
  children,
  params,
}: {
  children: React.ReactNode;
  params: Promise<{ locale: string }>;
}) {
  const { locale } = await params;
  setRequestLocale(locale);
  const messages = await getMessages();

  return (
    <html lang={locale} suppressHydrationWarning>
      <body>
        <NextIntlClientProvider messages={messages}>{children}</NextIntlClientProvider>
      </body>
    </html>
  );
}

export default function LocaleLayout({
  children,
  params,
}: {
  children: React.ReactNode;
  params: Promise<{ locale: string }>;
}) {
  return (
    <Suspense fallback={null}>
      <LocaleContent params={params}>{children}</LocaleContent>
    </Suspense>
  );
}
```

ãƒã‚¤ãƒ³ãƒˆã¯ **`<html>` ã‚¿ã‚°ã”ã¨ `<Suspense>` ã®ä¸­ã«å…¥ã‚Œã‚‹** ã“ã¨ã€‚ã“ã‚Œã«ã‚ˆã‚Š `await params` ãŒ Suspense å¢ƒç•Œå†…ã«åã¾ã‚Šã€`<html lang>` ã‚‚ SSR ã§æ­£ã—ãå‡ºåŠ›ã•ã‚Œã‚‹ã€‚

`cacheComponents` ã‚’ä½¿ã‚ãªã„å ´åˆã¯ã“ã®å•é¡Œã¯ç™ºç”Ÿã—ãªã„ãŒã€ä»Šå¾Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæœ‰åŠ¹ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€`setRequestLocale()` ã‚’å‘¼ã¶ç¿’æ…£ã¯ã¤ã‘ã¦ãŠãã¨ã‚ˆã„ã€‚

## Next.js 15 ã‹ã‚‰ã®ç§»è¡Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

1. `middleware.ts` ã‚’ `proxy.ts` ã«ç§»è¡Œã™ã‚‹
2. `params` ã®åŒæœŸã‚¢ã‚¯ã‚»ã‚¹ã‚’ã™ã¹ã¦ `await` ã«å¤‰æ›´ã™ã‚‹
3. `cookies()` ã‚„ `headers()` ã‚’ä½¿ã£ãŸãƒ­ã‚±ãƒ¼ãƒ«æ¤œå‡ºã‚’éåŒæœŸã«å¤‰æ›´ã™ã‚‹
4. Parallel Routes ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ `default.tsx` ã‚’è¿½åŠ ã™ã‚‹
5. `cacheComponents` ã‚’æœ‰åŠ¹ã«ã™ã‚‹å ´åˆã¯ `setRequestLocale()` ã‚’å¿˜ã‚Œãšã«å‘¼ã¶
6. Parallel Routes + `cacheComponents` ã®å ´åˆã¯ locale layout ã‚’ Suspense ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¤‰æ›´ã™ã‚‹
7. Edge Runtime ã‚’å‰æã«ã—ãŸãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ç›´ã™ï¼ˆ`proxy.ts` ã¯ Node.js ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ã¿ï¼‰
