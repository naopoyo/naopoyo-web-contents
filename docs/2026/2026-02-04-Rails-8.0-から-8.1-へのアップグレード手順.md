---
draft: false
emoji: ğŸ›¤ï¸
title: Rails 8.0 ã‹ã‚‰ 8.1 ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹é †
slug: rails-80-to-81-upgrade-guide
published_at: 2026-02-04 16:07:31
modified_at: 2026-02-04 16:07:31
tags:
  - Rails
  - Ruby
preview: null
---

## ã“ã®è¨˜äº‹ã®ãƒã‚¤ãƒ³ãƒˆ

- Rails 8.0 â†’ 8.1 ã¯æ¯”è¼ƒçš„å°è¦æ¨¡ãªã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ã€ç ´å£Šçš„å¤‰æ›´ã¯å°‘ãªã„
- `bin/rails app:update` å®Ÿè¡Œæ™‚ã« CORS è¨­å®šãŒã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚Œã‚‹å•é¡Œã«æ³¨æ„
- Active Storage ã‚’ä½¿ã£ã¦ã„ãªã„å ´åˆã€è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯å‰Šé™¤ã—ã¦ã‚ˆã„
- `to_time_preserves_timezone` è¨­å®šã¯ 8.1 ã§éæ¨å¥¨ã«ãªã£ãŸãŸã‚å‰Šé™¤ã™ã‚‹
- `schema.rb` ã®ã‚«ãƒ©ãƒ é †åºãŒã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«å¤‰æ›´ã•ã‚Œã‚‹ãŸã‚ã€ã‚¹ã‚­ãƒ¼ãƒãƒ€ãƒ³ãƒ—ã‚’å®Ÿè¡Œã—ã¦ã‚³ãƒŸãƒƒãƒˆã«å«ã‚ã‚‹

## å‰ææ¡ä»¶

- Ruby 3.2.0 ä»¥ä¸Š
- Rails 8.0.x

## ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ‰‹é †

### 1. Gemfile ã®æ›´æ–°

```ruby
# å¤‰æ›´å‰
gem "rails", "~> 8.0"

# å¤‰æ›´å¾Œ
gem "rails", "~> 8.1"
```

### 2. bundle update ã®å®Ÿè¡Œ

```bash
bundle update rails
```

### 3. app:update ã®å®Ÿè¡Œ

```bash
bundle exec rails app:update
```

å¯¾è©±å½¢å¼ã§å„ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°ã‚’ç¢ºèªã•ã‚Œã¾ã™ã€‚åŸºæœ¬çš„ãªåˆ¤æ–­åŸºæº–ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

- `config/application.rb` â†’ ã‚¹ã‚­ãƒƒãƒ—ï¼ˆæ—¢å­˜è¨­å®šã‚’ç¶­æŒï¼‰
- `config/environments/*.rb` â†’ å·®åˆ†ã‚’ç¢ºèªã—ã¦åˆ¤æ–­
- `config/initializers/new_framework_defaults_8_1.rb` â†’ ä½œæˆ
- `bin/*` â†’ ä¸Šæ›¸ã
- `config/routes.rb` â†’ ã‚¹ã‚­ãƒƒãƒ—

### 4. load_defaults ã®æ›´æ–°

`config/application.rb` ã‚’ç·¨é›†ã—ã¾ã™ã€‚

```ruby
config.load_defaults 8.1
```

### 5. å¤ã„ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤

`load_defaults 8.0` ã§å…¨ã¦é©ç”¨æ¸ˆã¿ã®ãŸã‚ã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Œã°å‰Šé™¤ã—ã¾ã™ã€‚

```bash
rm config/initializers/new_framework_defaults_7_1.rb
```

### 6. ã‚¹ã‚­ãƒ¼ãƒãƒ€ãƒ³ãƒ—ã®å®Ÿè¡Œ

Rails 8.1 ã§ã¯ `schema.rb` ã®ã‚«ãƒ©ãƒ é †åºãŒã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«ã‚½ãƒ¼ãƒˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å¾Œã«ã‚¹ã‚­ãƒ¼ãƒãƒ€ãƒ³ãƒ—ã‚’å®Ÿè¡Œã—ã¦ã€å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã«å«ã‚ã¾ã™ã€‚

```bash
bundle exec rails db:schema:dump
```

ã“ã®å¤‰æ›´ã«ã‚ˆã‚Šã€`schema.rb` ã®å·®åˆ†ãŒå¤§ãããªã‚Šã¾ã™ãŒã€ã“ã‚Œã¯ä¸€åº¦é™ã‚Šã®å¤‰æ›´ã§ã™ã€‚ä»¥é™ã¯ã‚«ãƒ©ãƒ é †åºãŒä¸€è²«ã™ã‚‹ãŸã‚ã€ãƒã‚·ãƒ³é–“ã§ã®ã‚¹ã‚­ãƒ¼ãƒãƒ€ãƒ³ãƒ—ã®å·®åˆ†ãŒæ¸›ã‚Šã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

å¤‰æ›´ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

```ruby
# å¤‰æ›´å‰ï¼ˆå®šç¾©é †ï¼‰
create_table "assets" do |t|
  t.bigint "workspace_id", null: false
  t.string "file", null: false
  t.string "name", limit: 100, null: false
  t.string "checksum", limit: 64, null: false
  t.datetime "created_at", null: false
  t.datetime "updated_at", null: false
end

# å¤‰æ›´å¾Œï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ï¼‰
create_table "assets" do |t|
  t.string "checksum", limit: 64, null: false
  t.datetime "created_at", null: false
  t.string "file", null: false
  t.string "name", limit: 100, null: false
  t.datetime "updated_at", null: false
  t.bigint "workspace_id", null: false
end
```

### 7. ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
bundle exec rails zeitwerk:check
bundle exec rspec
```

## æ³¨æ„ãŒå¿…è¦ãªãƒã‚¤ãƒ³ãƒˆ

### CORS è¨­å®šã®ä¸Šæ›¸ãå•é¡Œ

`app:update` ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€`config/initializers/cors.rb` ãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ä¸Šæ›¸ãã•ã‚Œã€æ—¢å­˜ã® CORS è¨­å®šãŒå…¨ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

API ã¨ã—ã¦å‹•ä½œã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ã“ã®å¤‰æ›´ã«ã‚ˆã‚Š API ãŒå‹•ä½œã—ãªããªã‚Šã¾ã™ã€‚ä¸Šæ›¸ãã—ã¦ã—ã¾ã£ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å¾©å…ƒã§ãã¾ã™ã€‚

```bash
git checkout config/initializers/cors.rb
```

### Active Storage ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®è‡ªå‹•ç”Ÿæˆ

`app:update` å®Ÿè¡Œæ™‚ã« Active Storage é–¢é€£ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```text
db/migrate/YYYYMMDD..._add_service_name_to_active_storage_blobs.active_storage.rb
db/migrate/YYYYMMDD..._create_active_storage_variant_records.active_storage.rb
db/migrate/YYYYMMDD..._remove_not_null_on_active_storage_blobs_checksum.active_storage.rb
```

CarrierWave ãªã©ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ã„ã¦ Active Storage ã‚’ä½¿ã£ã¦ã„ãªã„å ´åˆã€ã“ã‚Œã‚‰ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä¸è¦ã§ã™ã€‚å‰Šé™¤ã—ã¦å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

### éæ¨å¥¨è¨­å®šã®å‰Šé™¤

`config.active_support.to_time_preserves_timezone` ã¯ Rails 8.1 ã§éæ¨å¥¨ã¨ãªã‚Šã€8.2 ã§å‰Šé™¤äºˆå®šã§ã™ã€‚ã“ã®è¨­å®šãŒ `config/environments/test.rb` ãªã©ã«å­˜åœ¨ã™ã‚‹å ´åˆã¯å‰Šé™¤ã—ã¾ã™ã€‚

```ruby
# å‰Šé™¤ã™ã‚‹è¡Œ
config.active_support.to_time_preserves_timezone = :zone
```

8.1 ã§ã¯ `:zone` ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã¨ãªã£ã¦ã„ã‚‹ãŸã‚ã€å‰Šé™¤ã—ã¦ã‚‚æŒ™å‹•ã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚

## æ–°æ©Ÿèƒ½

Rails 8.1 ã§è¿½åŠ ã•ã‚ŒãŸä¸»ãªæ©Ÿèƒ½ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚

### ãƒ­ãƒ¼ã‚«ãƒ« CI æ©Ÿèƒ½

`bin/ci` ã‚³ãƒãƒ³ãƒ‰ã¨ `config/ci.rb` ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ã§ CI ç›¸å½“ã®ãƒã‚§ãƒƒã‚¯ã‚’ä¸€æ‹¬å®Ÿè¡Œã§ãã‚‹æ©Ÿèƒ½ã§ã™ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç”Ÿæˆã•ã‚Œã‚‹ `config/ci.rb` ã«ã¯ RuboCop ã¨ Brakeman ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

```ruby
# config/ci.rb
CI.run do
  step "Setup", "bin/setup --skip-server"
  step "Style: Ruby", "bin/rubocop"
  step "Security: Brakeman code analysis", "bin/brakeman --quiet --no-pager --exit-on-warn --exit-on-error"
end
```

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«åˆã‚ã›ãŸã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

RSpec ãªã©ã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ã€`config/ci.rb` ã‚’ç·¨é›†ã—ã¾ã™ã€‚

```ruby
# config/ci.rb
CI.run do
  step "Setup", "bin/setup --skip-server"
  step "Style: Ruby", "bin/rubocop"
  step "Security: Brakeman", "bin/brakeman --quiet --no-pager --exit-on-warn --exit-on-error"
  step "Test: RSpec", "bin/rspec"
end
```

#### å®Ÿè¡Œæ–¹æ³•

```bash
bin/ci
```

å„ã‚¹ãƒ†ãƒƒãƒ—ãŒé †ç•ªã«å®Ÿè¡Œã•ã‚Œã€å¤±æ•—ã—ãŸå ´åˆã¯ãã“ã§åœæ­¢ã—ã¾ã™ã€‚å…¨ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒæˆåŠŸã™ã‚‹ã¨ã€CI ãŒé€šã£ãŸã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

#### æ´»ç”¨ã‚·ãƒ¼ãƒ³

ãƒ­ãƒ¼ã‚«ãƒ« CI ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå ´é¢ã§å½¹ç«‹ã¡ã¾ã™ã€‚

- ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹å‰ã«ã€CI ã§å¤±æ•—ã—ãªã„ã“ã¨ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ç¢ºèªã—ãŸã„
- GitHub Actions ãªã©ã®ãƒªãƒ¢ãƒ¼ãƒˆ CI ã®å®Ÿè¡Œã‚’å¾…ãŸãšã«ã€æ‰‹å…ƒã§ç´ æ—©ããƒã‚§ãƒƒã‚¯ã—ãŸã„
- ãƒãƒ¼ãƒ å…¨ä½“ã§çµ±ä¸€ã•ã‚ŒãŸ CI ãƒã‚§ãƒƒã‚¯æ‰‹é †ã‚’å…±æœ‰ã—ãŸã„

#### GitHub ã¨ã®é€£æº

`gh` CLI ã¨ `gh-signoff` æ‹¡å¼µã‚’ä½¿ã†ã¨ã€CI æˆåŠŸæ™‚ã« GitHub ã®ã‚³ãƒŸãƒƒãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ­ãƒ¼ã‚«ãƒ« CI ãŒé€šã£ãŸ PR ã®ã¿ãƒãƒ¼ã‚¸å¯èƒ½ã«ã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚‚å®Ÿç¾ã§ãã¾ã™ã€‚

```ruby
# config/ci.rb
CI.run do
  step "Setup", "bin/setup --skip-server"
  step "Style: Ruby", "bin/rubocop"
  step "Test: RSpec", "bin/rspec"

  if success?
    step "Signoff", "gh signoff"
  end
end
```

ã“ã®æ©Ÿèƒ½ã‚’ä½¿ã†ã«ã¯ã€äº‹å‰ã«ä»¥ä¸‹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå¿…è¦ã§ã™ã€‚

```bash
gh extension install basecamp/gh-signoff
```

### Active Job Continuable

é•·æ™‚é–“å®Ÿè¡Œã™ã‚‹ã‚¸ãƒ§ãƒ–ã‚’è¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—ã«åˆ†å‰²ã—ã€ä¸­æ–­å¾Œã«ç¶šãã‹ã‚‰å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

### schema.rb ã®ã‚«ãƒ©ãƒ é †åºå¤‰æ›´

å‰è¿°ã®ã¨ãŠã‚Šã€`schema.rb` å†…ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚«ãƒ©ãƒ ãŒã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«ã‚½ãƒ¼ãƒˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

## å‚è€ƒãƒªãƒ³ã‚¯

- [Ruby on Rails 8.1 ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ](https://railsguides.jp/8_1_release_notes.html)
- [Ruby on Rails ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚¬ã‚¤ãƒ‰](https://railsguides.jp/upgrading_ruby_on_rails.html)
