---
draft: false
emoji: ğŸ“ˆ
title: Next.jsã§Bundle Analyzerã‚’ä½¿ã†
slug: steps-to-use-the-bundle-analyzer-in-nextjs
published_at: 2024-07-14 14:04:35
modified_at: 2025-10-16 23:27:19
tags:
  - Next.js
preview: null
type: default
---

## ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã§ã¯ Next.js ã§ Bundle Analyzerï¼ˆ`@next/bundle-analyzer`ï¼‰ã‚’ä½¿ã£ã¦ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã‚’å¯è¦–åŒ–ã™ã‚‹æ‰‹é †ã‚’ã¾ã¨ã‚ã¾ã™ã€‚pnpm ã‚’ä½¿ã£ãŸç’°å¢ƒã§ã®ä¾‹ã‚’ç¤ºã—ã¾ã™ãŒã€npm / yarn ã§ã‚‚åŒæ§˜ã§ã™ã€‚

ç›®çš„:

- ãƒ“ãƒ«ãƒ‰æ™‚ã«ãƒãƒ³ãƒ‰ãƒ«ã®å¯è¦–åŒ–ã‚’è¡Œã„ã€ã‚µã‚¤ã‚ºãŒå¤§ãã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚„ãƒãƒ£ãƒ³ã‚¯ã‚’ç‰¹å®šã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
- ãƒ­ãƒ¼ã‚«ãƒ«ã§è§£æçµæœï¼ˆHTMLï¼‰ã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

ã“ã®è¨˜äº‹ã®ã‚´ãƒ¼ãƒ«ã¯ã€ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã§è§£æã‚’è¡Œã„ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§çµæœã‚’ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã™ã€‚

```sh:Terminal
pnpm analyze
```

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```sh:Terminal
pnpm add -D -E @next/bundle-analyzer
```

## `next.config.js` ã‚’ä¿®æ­£

```javascript:next.config.js
/** @type {import('next').NextConfig} */

// CommonJS (defaultã®next.config.jsãŒCommonJSã®å ´åˆ)
const withBundleAnalyzer = require('@next/bundle-analyzer')({
  enabled: process.env.ANALYZE === 'true',
})

const nextConfig = {
  //...
}

module.exports = withBundleAnalyzer(nextConfig)
```

ESMã®ä¾‹:

```javascript:next.config.mjs
import withBundleAnalyzer from '@next/bundle-analyzer'

const enabled = process.env.ANALYZE === 'true'

const nextConfig = {
  // ...
}

export default withBundleAnalyzer({ enabled })(nextConfig)
```

## `package.json` ã®scriptsã‚’ä¿®æ­£

```json:package.json
{
  "scripts": {
    "analyze": "ANALYZE=true next build"
  },
}
```

ä»¥ä¸Šã§Bundle Analyzerã§ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®ç¢ºèªãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## å®Ÿè¡Œã¨çµæœã®ç¢ºèª

1. è§£æã‚’å®Ÿè¡Œ

   ```sh:Terminal
   pnpm analyze
   ```

2. å‡ºåŠ›å ´æ‰€

   è§£æçµæœã¯ãƒ“ãƒ«ãƒ‰å‡ºåŠ›ã®ä¸‹ã« `.next/analyze` é…ä¸‹ã« HTML ã¨ã—ã¦å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç’°å¢ƒã‚„ Next.js ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦è‹¥å¹²å¤‰ã‚ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€åŸºæœ¬çš„ã«ã¯ HTML ãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã§ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ç¢ºèªã§ãã¾ã™ã€‚

3. ãƒ­ãƒ¼ã‚«ãƒ«ã§è¦‹ã‚‹ï¼ˆç°¡æ˜“ã‚µãƒ¼ãƒ–ï¼‰

   macOS / Linux ã§ç°¡å˜ã«é–‹ãæ–¹æ³•:

   ```sh:Terminal
   # Finder / ãƒ•ã‚¡ã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãï¼ˆmacOSï¼‰
   open .next/analyze/index.html

   # ã‚‚ã—ãã¯ç°¡æ˜“HTTPã‚µãƒ¼ãƒã§é…ä¿¡ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª
   npx http-server .next/analyze -c-1
   # ã¾ãŸã¯
   npx serve .next/analyze
   ```

> [!WARNING]
>
> - Next.js ã®æ–°ã—ã„ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ Turbopack ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆï¼ˆ`--turbopack` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã‚„ã€Next ã®å°†æ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯æœ¬ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒå‹•ä½œã—ãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚Bundle Analyzer ã¯ä¸»ã« webpack ãƒ™ãƒ¼ã‚¹ã®ãƒ“ãƒ«ãƒ‰å‘ã‘ã§ã™ã€‚
> - `ANALYZE=true next build` ã®ã‚ˆã†ã«ç’°å¢ƒå¤‰æ•°ã§æœ‰åŠ¹åŒ–ã™ã‚‹æ–¹æ³•ã¯ macOS / Linux ã§ã¯ãã®ã¾ã¾å‹•ä½œã—ã¾ã™ãŒã€Windows ã® CMD ã§ã¯å‹•ãã¾ã›ã‚“ã€‚ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«å¯¾å¿œã™ã‚‹ã«ã¯ `cross-env` ã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚
> - å¤§ããªãƒãƒ³ãƒ‰ãƒ«ãŒè¦‹ã¤ã‹ã£ãŸã‚‰ã€dynamic importsï¼ˆå‹•çš„ importï¼‰ã€ã‚³ãƒ¼ãƒ‰åˆ†å‰²ã€ä¸è¦ãª polyfill ã®å‰Šé™¤ã€ä¾å­˜å…ˆã®è¦‹ç›´ã—ãªã©ã§å¯¾å‡¦ã—ã¾ã™ã€‚

## ä¾¿åˆ©ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆä¾‹

```json:package.json
"scripts": {
  "analyze": "ANALYZE=true next build",
  "analyze:open": "pnpm analyze && open .next/analyze",
  "analyze:server": "pnpm analyze && npx http-server .next/analyze -c-1"
}
```

- `analyze:open`: è§£æçµæœã‚’é–‹ãï¼ˆmacOS å‘ã‘ï¼‰
- `analyze:server`: Dev Containerã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆãªã©ã¯ç°¡æ˜“HTTPã‚µãƒ¼ãƒã§é…ä¿¡ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª

ä»¥ä¸Šã§ Bundle Analyzer ã«ã‚ˆã‚‹ãƒãƒ³ãƒ‰ãƒ«ç¢ºèªãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

## å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

::link-card[https://nextjs.org/docs/app/building-your-application/optimizing/bundle-analyzer]
