---
draft: false
emoji: ğŸ›€
title: Next.jsã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’Dockerã‚³ãƒ³ãƒ†ãƒŠä¸Šã«ä½œæˆã™ã‚‹
slug: create-a-nextjs-project-on-a-docker-container
published_at: 2024-09-23 20:45:47
modified_at: 2024-09-23 20:45:47
tags:
  - Next.js
  - Docker
preview: null
---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```tree:ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
Project Root
â”œâ”€â”€ Taskfile.yaml
â”œâ”€â”€ docker
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â””â”€â”€ client
â”‚       â””â”€â”€ Dockerfile
â””â”€â”€ client
    â””â”€â”€ .devcontainer
        â””â”€â”€ devcontainer.json
```

## Taskfile.ymlä½œæˆ

```yaml:Taskfile.yml
version: '3'

tasks:
  'dev:build':
    desc: é–‹ç™ºç’°å¢ƒã‚³ãƒ³ãƒ†ãƒŠãƒ“ãƒ«ãƒ‰
    cmds:
      - docker-compose -f docker/docker-compose.yml up -d --build
  'dev:start':
    desc: é–‹ç™ºç’°å¢ƒã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
    cmds:
      - docker-compose -f docker/docker-compose.yml up -d
  'dev:stop':
    desc: é–‹ç™ºç’°å¢ƒã‚³ãƒ³ãƒ†ãƒŠåœæ­¢
    cmds:
      - docker-compose -f docker/docker-compose.yml down
```

## Dockerfileä½œæˆ

```dockerfile:docker/client/Dockerfile
FROM node:20-slim
WORKDIR /tmp
ENV PNPM_HOME /usr/local/bin
RUN apt-get update && apt-get install -y \
    build-essential \
    python3 \
    wget \
    git \
    zsh \
    vim \
    nano \
 && apt-get clean \
 && rm -rf /var/lib/apt/lists/* \
 && corepack enable \
 && pnpm config set store-dir /var/workspace/client/node_modules/.pnpm-store
```

```yaml:docker/docker-compose.yml
version: "3"

name: "project"

volumes:
  client_node_modules:
  client_dot_next:
  client_workspace_root:

services:
  client_workspace:
    build: client
    command: sleep infinity
    volumes:
      - ../:/var/workspace/:cached
      - ~/.ssh/:/root/.ssh/
      - client_node_modules:/var/workspace/client/node_modules
      - client_dot_next:/var/workspace/client/.next
      - client_workspace_root:/root/
  client:
    build: client
    working_dir: /var/workspace/client
    command: sh -c 'pnpm i && pnpm dev'
    volumes:
      - ../:/var/workspace/:cached
      - client_node_modules:/var/workspace/client/node_modules
      - client_dot_next:/var/workspace/client/.next
    ports:
      - 3000:3000
```

## Devcontainerã®è¨­å®š

```json:client/.devcontainer/devcontainer.json
{
  "name": "project-client",
  "dockerComposeFile": "../../docker/docker-compose.yml",
  "service": "client_workspace",
  "workspaceFolder": "/var/workspace/client",
  "customizations": {
    "vscode": {
      "extensions": [
        "bradlc.vscode-tailwindcss",
        "dbaeumer.vscode-eslint",
        "donjayamanne.githistory",
        "EditorConfig.EditorConfig",
        "esbenp.prettier-vscode",
        "GitHub.vscode-pull-request-github",
        "GraphQL.vscode-graphql-syntax",
        "GraphQL.vscode-graphql"
      ]
    }
  },
  "shutdownAction": "none"
}
```

## Next.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

```sh:Terminal
pnpm create next-app my-app --ts --tailwind --eslint --app --src-dir --import-alias '@/*'
```

```sh:Terminal
rm -rf ./my-app/node_modules
mv ./my-app/.* ./my-app/* ./my-app/..
rm -rf ./my-app/
pnpm i
```

## é–‹ç™ºç”¨ã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```sh:Terminal
task dev:build
```
