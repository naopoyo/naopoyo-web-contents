---
draft: false
emoji: 😎
title: Next.jsのThird Party Librariesを使ってGoogle Analyticsを導入する
slug: introduce-google-analytics-using-third-party-libraries-in-nextjs
published_at: 2024-01-08 22:39:43
modified_at: 2024-01-08 22:39:43
tags:
    - Next.js
preview: null
---

## 概要

Next.jsの[Third Party Libraries](https://nextjs.org/docs/app/building-your-application/optimizing/third-party-libraries)を使えば、簡単にGoogle Analyticsを導入できます。

## @next/third-partiesをインストール

```sh:Terminal
pnpm add @next/third-parties
```

## 環境変数を追加

```sh:.env
GTM_ID=G-XXXXXXXXXX
```

## app/layout.tsxにコンポーネントを配置

```typescript:app/layout.tsx
import { GoogleTagManager } from '@next/third-parties/google'

const isProduction = process.env.NODE_ENV === 'production'
const gtmId = process.env.GTM_ID!

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>{children}</body>
      {isProduction && <GoogleTagManager gtmId={gtmId} />}
    </html>
  )
}
```

## Google Analyticsの測定 ID(gtmId)の確認方法

![サイドメニューの「管理」](/assets/2024-01-08-next.jsのthird-party-librariesを使ってgoogle-analyticsを導入する.webp)

1. サイドメニューの「管理」(上記画像)
2. データの収集と修正
3. データストリーム
4. 対象の「ウェブ ストリームの詳細」を開く
